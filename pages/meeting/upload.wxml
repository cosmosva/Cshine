<!--会议音频上传页-->
<view class="meeting-upload-page">
  <!-- 自定义导航栏 -->
  <navigation-bar title="{{mode === 'upload' ? '上传会议' : '处理中'}}" showBack="{{true}}" />

  <view class="page-content">
    <!-- 上传模式 -->
    <view class="upload-mode" wx:if="{{mode === 'upload' && status === 'idle'}}">
      <!-- 表单区域 -->
      <view class="form-section">
        <!-- 会议主题 -->
        <view class="form-item">
          <view class="form-label">会议主题 <text class="required">*</text></view>
          <input 
            class="form-input"
            placeholder="请输入会议主题"
            value="{{title}}"
            bindinput="onTitleInput"
            maxlength="100"
          />
        </view>

        <!-- 参会人 -->
        <view class="form-item">
          <view class="form-label">参会人（可选）</view>
          <input 
            class="form-input"
            placeholder="用逗号分隔，如：张三,李四"
            value="{{participants}}"
            bindinput="onParticipantsInput"
          />
        </view>

        <!-- 会议日期 -->
        <view class="form-item">
          <view class="form-label">会议日期（可选）</view>
          <picker 
            mode="date"
            value="{{meetingDate}}"
            end="{{maxDate}}"
            bindchange="onDateChange"
          >
            <view class="form-input picker">
              {{meetingDate || '选择日期'}}
            </view>
          </picker>
        </view>

        <!-- 音频文件 -->
        <view class="form-item">
          <view class="form-label">音频文件 <text class="required">*</text></view>
          <view class="file-selector" bindtap="chooseAudio">
            <view class="file-info" wx:if="{{audioPath}}">
              <text class="file-icon">🎵</text>
              <text class="file-name">已选择文件</text>
            </view>
            <view class="file-placeholder" wx:else>
              <text class="icon">📁</text>
              <text class="text">点击选择音频文件</text>
              <text class="hint">支持 mp3/m4a/wav 等格式，最大500MB</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 提交按钮 -->
      <view class="submit-section">
        <button class="submit-btn" bindtap="submitUpload">
          开始处理
        </button>
        <text class="submit-hint">预计需要几分钟，请耐心等待</text>
      </view>
    </view>

    <!-- 处理中模式 -->
    <view class="processing-mode" wx:if="{{status === 'uploading' || status === 'processing'}}">
      <view class="processing-card">
        <!-- 进度环 -->
        <view class="progress-ring">
          <view class="progress-value">{{progress}}%</view>
        </view>

        <!-- 状态信息 -->
        <view class="status-info">
          <view class="status-title">{{title}}</view>
          <view class="status-text">
            <text wx:if="{{status === 'uploading'}}">正在上传文件...</text>
            <text wx:if="{{status === 'processing'}}">正在处理中...</text>
          </view>
          <view class="status-desc">
            AI 正在分析会议内容，包括：
          </view>
          <view class="process-steps">
            <view class="step-item">✓ 语音转文字</view>
            <view class="step-item {{progress >= 60 ? 'active' : ''}}">
              {{progress >= 60 ? '✓' : '○'}} 提取会议要点
            </view>
            <view class="step-item {{progress >= 80 ? 'active' : ''}}">
              {{progress >= 80 ? '✓' : '○'}} 识别行动项
            </view>
            <view class="step-item {{progress >= 100 ? 'active' : ''}}">
              {{progress >= 100 ? '✓' : '○'}} 生成会议纪要
            </view>
          </view>
        </view>

        <!-- 进度条 -->
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{progress}}%;"></view>
        </view>
      </view>
    </view>

    <!-- 完成模式 -->
    <view class="completed-mode" wx:if="{{status === 'completed'}}">
      <view class="success-card">
        <text class="success-icon">✓</text>
        <text class="success-title">处理完成！</text>
        <text class="success-desc">正在跳转到详情页...</text>
      </view>
    </view>

    <!-- 失败模式 -->
    <view class="failed-mode" wx:if="{{status === 'failed'}}">
      <view class="error-card">
        <text class="error-icon">⚠️</text>
        <text class="error-title">处理失败</text>
        <text class="error-desc">{{errorMessage || '音频处理出错，请稍后重试'}}</text>
        <button class="retry-btn" bindtap="backToList">返回列表</button>
      </view>
    </view>
  </view>
</view>

