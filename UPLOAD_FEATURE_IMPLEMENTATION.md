# ä¸Šä¼ åŠŸèƒ½å¼€å‘å®Œæˆæ€»ç»“

## ğŸ“‹ å¼€å‘å†…å®¹

æŒ‰ç…§ `UPLOAD_FEATURE_PLAN.md` æ–‡æ¡£å®Œæˆäº† P0 æ ¸å¿ƒåŠŸèƒ½çš„å¼€å‘ï¼ŒåŒ…æ‹¬å‰ç«¯å’Œåç«¯çš„å®Œæ•´å®ç°ã€‚

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### å‰ç«¯å¼€å‘ï¼ˆå°ç¨‹åºç«¯ï¼‰

1. **UI ç»„ä»¶å¼€å‘**
   - âœ… åœ¨ `pages/meeting/list.wxml` æ·»åŠ ä¸Šä¼  ActionSheet UI
   - âœ… åœ¨ `pages/meeting/list.wxml` æ·»åŠ çŸ¥è¯†åº“é€‰æ‹© Modal UI  
   - âœ… åœ¨ `pages/meeting/list.wxml` æ·»åŠ æ–°å»ºçŸ¥è¯†åº“ Modal UI
   - âœ… åœ¨ `pages/meeting/list.wxss` æ·»åŠ  Modal ç›¸å…³æ ·å¼

2. **ä¸šåŠ¡é€»è¾‘å¼€å‘**
   - âœ… åœ¨ `pages/meeting/list.js` å®ç°ä¸Šä¼ æ–‡ä»¶é€‰æ‹©é€»è¾‘
   - âœ… åœ¨ `pages/meeting/list.js` å®ç°éŸ³é¢‘æ—¶é•¿æå–
   - âœ… åœ¨ `pages/meeting/list.js` å®ç°çŸ¥è¯†åº“é€‰æ‹©é€»è¾‘
   - âœ… åœ¨ `pages/meeting/list.js` å®ç°æ–°å»ºçŸ¥è¯†åº“é€»è¾‘

3. **ä¸Šä¼ é¡µé¢ä¼˜åŒ–**
   - âœ… ä¿®æ”¹ `pages/meeting/upload.wxml` çš„æ–‡æ¡ˆï¼ˆ"ä¸Šä¼ ä¸­"ã€"æ­£åœ¨ä¸Šä¼ æ–‡ä»¶åˆ°äº‘ç«¯"ï¼‰
   - âœ… ä¿®æ”¹ `pages/meeting/upload.js` æ”¯æŒ OSS ä¸Šä¼ å’Œè¿›åº¦ç›‘å¬
   - âœ… æ”¯æŒä» list é¡µé¢ä¼ é€’æ–‡ä»¶ä¿¡æ¯å¹¶è‡ªåŠ¨ä¸Šä¼ 

4. **API é›†æˆ**
   - âœ… åœ¨ `utils/api.js` æ·»åŠ çŸ¥è¯†åº“ç›¸å…³ APIï¼ˆcreateFolder, getFolders, updateFolder, deleteFolderï¼‰
   - âœ… åœ¨ `utils/api.js` æ·»åŠ  OSS ç­¾åè·å– APIï¼ˆgetOssSignatureï¼‰

5. **å…¨å±€æ•°æ®ç®¡ç†**
   - âœ… åœ¨ `app.js` çš„ globalData æ·»åŠ  uploadFile å­—æ®µç”¨äºæ–‡ä»¶ä¼ é€’

### åç«¯å¼€å‘ï¼ˆFastAPIï¼‰

1. **æ•°æ®æ¨¡å‹**
   - âœ… åœ¨ `backend/app/models.py` æ·»åŠ  Folder æ¨¡å‹ï¼ˆçŸ¥è¯†åº“è¡¨ï¼‰
   - âœ… åœ¨ `backend/app/models.py` çš„ Meeting æ¨¡å‹æ·»åŠ  folder_id å­—æ®µ
   - âœ… åœ¨ `backend/app/models.py` çš„ User æ¨¡å‹æ·»åŠ  folders å…³ç³»

2. **æ•°æ®éªŒè¯ Schema**
   - âœ… åœ¨ `backend/app/schemas.py` æ·»åŠ  FolderCreateã€FolderUpdateã€FolderResponseã€FolderListResponse
   - âœ… åœ¨ `backend/app/schemas.py` çš„ MeetingCreate æ·»åŠ  folder_id å­—æ®µ
   - âœ… åœ¨ `backend/app/schemas.py` çš„ MeetingResponse æ·»åŠ  folder_id å­—æ®µ

3. **API è·¯ç”±å¼€å‘**
   - âœ… æ–°å»º `backend/app/api/folder.py` å®ç°çŸ¥è¯†åº“ CRUD API
     - POST /api/v1/folders - åˆ›å»ºçŸ¥è¯†åº“
     - GET /api/v1/folders - è·å–çŸ¥è¯†åº“åˆ—è¡¨ï¼ˆå¸¦ä¼šè®®æ•°é‡ç»Ÿè®¡ï¼‰
     - GET /api/v1/folders/{folder_id} - è·å–çŸ¥è¯†åº“è¯¦æƒ…
     - PUT /api/v1/folders/{folder_id} - æ›´æ–°çŸ¥è¯†åº“
     - DELETE /api/v1/folders/{folder_id} - åˆ é™¤çŸ¥è¯†åº“
   
4. **ä¼šè®® API å¢å¼º**
   - âœ… ä¿®æ”¹ `backend/app/api/meeting.py` çš„åˆ›å»ºæ¥å£æ”¯æŒ folder_id
   - âœ… ä¿®æ”¹ `backend/app/api/meeting.py` çš„åˆ—è¡¨æ¥å£æ”¯æŒæŒ‰ folder_id ç­›é€‰

5. **OSS ä¸Šä¼ ä¼˜åŒ–**
   - âœ… åœ¨ `backend/app/utils/oss.py` æ·»åŠ  generate_oss_upload_signature å‡½æ•°
   - âœ… åœ¨ `backend/app/api/upload.py` æ·»åŠ  GET /api/v1/upload/oss-signature æ¥å£

6. **è·¯ç”±æ³¨å†Œ**
   - âœ… åœ¨ `backend/app/api/__init__.py` æ³¨å†Œ folder è·¯ç”±

7. **æ•°æ®åº“è¿ç§»**
   - âœ… åˆ›å»º `backend/migrations/add_folders_and_folder_id.py` è¿ç§»è„šæœ¬

## ğŸ“‚ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### å‰ç«¯æ–‡ä»¶
```
pages/meeting/list.wxml          - æ·»åŠ  UI ç»„ä»¶
pages/meeting/list.wxss          - æ·»åŠ æ ·å¼
pages/meeting/list.js            - æ·»åŠ ä¸šåŠ¡é€»è¾‘
pages/meeting/upload.wxml        - ä¿®æ”¹æ–‡æ¡ˆ
pages/meeting/upload.js          - å¢å¼ºä¸Šä¼ é€»è¾‘
utils/api.js                     - æ·»åŠ  API æ–¹æ³•
app.js                           - æ·»åŠ å…¨å±€æ•°æ®
```

### åç«¯æ–‡ä»¶
```
backend/app/models.py            - æ·»åŠ  Folder æ¨¡å‹
backend/app/schemas.py           - æ·»åŠ  Folder schemas
backend/app/api/folder.py        - æ–°å»ºçŸ¥è¯†åº“ APIï¼ˆæ–°æ–‡ä»¶ï¼‰
backend/app/api/meeting.py       - å¢å¼ºä¼šè®® API
backend/app/api/upload.py        - æ·»åŠ ç­¾å API
backend/app/api/__init__.py      - æ³¨å†Œè·¯ç”±
backend/app/utils/oss.py         - æ·»åŠ ç­¾åå‡½æ•°
backend/migrations/add_folders_and_folder_id.py  - æ–°å»ºè¿ç§»è„šæœ¬ï¼ˆæ–°æ–‡ä»¶ï¼‰
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æ•°æ®åº“è¿ç§»
```bash
cd backend
python migrations/add_folders_and_folder_id.py
```

### 2. é‡å¯åç«¯æœåŠ¡
```bash
# å¦‚æœä½¿ç”¨ systemd
sudo systemctl restart cshine

# æˆ–è€…æ‰‹åŠ¨é‡å¯
cd backend
source venv/bin/activate
python main.py
```

### 3. å°ç¨‹åºç«¯éƒ¨ç½²
```bash
# åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ä¸Šä¼ ä»£ç 
# ç‰ˆæœ¬å·å»ºè®®ï¼šv1.1.0
# æ›´æ–°è¯´æ˜ï¼šæ–°å¢æ–‡ä»¶ä¸Šä¼ å’ŒçŸ¥è¯†åº“ç®¡ç†åŠŸèƒ½
```

## ğŸ” æ ¸å¿ƒåŠŸèƒ½æµç¨‹

### ä¸Šä¼ æ–‡ä»¶æµç¨‹
1. ç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’ "+" æŒ‰é’®
2. å¼¹å‡º ActionSheetï¼Œé€‰æ‹©"ä¸Šä¼ æ–‡ä»¶"
3. è°ƒç”¨ `wx.chooseMessageFile()` é€‰æ‹©éŸ³é¢‘æ–‡ä»¶
4. æå–éŸ³é¢‘æ—¶é•¿ï¼ˆä½¿ç”¨ `wx.createInnerAudioContext()`ï¼‰
5. æ˜¾ç¤ºçŸ¥è¯†åº“é€‰æ‹© Modalï¼Œç”¨æˆ·é€‰æ‹©ç›®æ ‡çŸ¥è¯†åº“
6. è·³è½¬åˆ°ä¸Šä¼ è¿›åº¦é¡µé¢
7. è·å– OSS ä¸Šä¼ ç­¾å
8. ä½¿ç”¨ `wx.uploadFile()` ç›´ä¼ åˆ° OSSï¼ˆå¸¦è¿›åº¦ç›‘å¬ï¼‰
9. è°ƒç”¨åç«¯ API åˆ›å»ºä¼šè®®è®°å½•ï¼ˆæºå¸¦ folder_idï¼‰
10. è§¦å‘ AI åå°å¤„ç†
11. è¿”å›åˆ—è¡¨é¡µå¹¶åˆ·æ–°

### æ–°å»ºçŸ¥è¯†åº“æµç¨‹
1. ç”¨æˆ·ç‚¹å‡» "+" æŒ‰é’®
2. é€‰æ‹©"æ–°å»ºçŸ¥è¯†åº“"
3. å¼¹å‡ºè¾“å…¥æ¡† Modal
4. è¾“å…¥çŸ¥è¯†åº“åç§°
5. è°ƒç”¨åç«¯ API åˆ›å»ºçŸ¥è¯†åº“
6. æ›´æ–°æœ¬åœ°çŸ¥è¯†åº“åˆ—è¡¨
7. æ˜¾ç¤ºæˆåŠŸæç¤º

## ğŸ“ æ³¨æ„äº‹é¡¹

### å‰ç«¯æ³¨æ„äº‹é¡¹
1. æ–‡ä»¶å¤§å°é™åˆ¶ï¼š500MB
2. æ”¯æŒæ ¼å¼ï¼šmp3, m4a, wav
3. éŸ³é¢‘æ—¶é•¿æå–å¯èƒ½å¤±è´¥ï¼Œéœ€è¦å…œåº•å¤„ç†
4. çŸ¥è¯†åº“åç§°ä¸èƒ½ä¸ºç©ºï¼Œæœ€é•¿ 20 å­—ç¬¦
5. ä¸Šä¼ è¿›åº¦å  0-30%ï¼Œåç»­ AI å¤„ç†å  30-100%

### åç«¯æ³¨æ„äº‹é¡¹
1. OSS ç­¾åæœ‰æ•ˆæœŸï¼š1 å°æ—¶ï¼ˆ3600ç§’ï¼‰
2. çŸ¥è¯†åº“åç§°å”¯ä¸€æ€§ï¼šåŒä¸€ç”¨æˆ·ä¸‹ä¸èƒ½é‡å
3. åˆ é™¤çŸ¥è¯†åº“æ—¶ï¼Œä¼šå°†å…³è”ä¼šè®®çš„ folder_id è®¾ç½®ä¸º NULL
4. æ•°æ®åº“ä½¿ç”¨ SQLiteï¼Œå¤–é”®çº¦æŸåœ¨åº”ç”¨å±‚é¢å®ç°
5. OSS é…ç½®éœ€è¦æ­£ç¡®è®¾ç½® ALIBABA_CLOUD_ACCESS_KEY_ID ç­‰ç¯å¢ƒå˜é‡

## ğŸ§ª æµ‹è¯•è¦ç‚¹

### åŠŸèƒ½æµ‹è¯•
- [ ] ç‚¹å‡» "+" æŒ‰é’®æ­£å¸¸å¼¹å‡º ActionSheet
- [ ] é€‰æ‹©"ä¸Šä¼ æ–‡ä»¶"æ­£å¸¸æ‰“å¼€æ–‡ä»¶é€‰æ‹©å™¨
- [ ] æ–‡ä»¶å¤§å°æ ¡éªŒï¼ˆè¶…è¿‡ 500MB æç¤ºé”™è¯¯ï¼‰
- [ ] æ–‡ä»¶æ ¼å¼æ ¡éªŒï¼ˆééŸ³é¢‘æ–‡ä»¶æç¤ºé”™è¯¯ï¼‰
- [ ] éŸ³é¢‘æ—¶é•¿æ­£å¸¸æå–
- [ ] çŸ¥è¯†åº“é€‰æ‹©é¡µæ­£å¸¸æ˜¾ç¤º
- [ ] çŸ¥è¯†åº“åˆ‡æ¢æ­£å¸¸å·¥ä½œ
- [ ] ä¸Šä¼ è¿›åº¦æ­£å¸¸æ˜¾ç¤º
- [ ] ä¸Šä¼ å®Œæˆåæ­£å¸¸è·³è½¬
- [ ] æ–°å»ºçŸ¥è¯†åº“æ­£å¸¸å·¥ä½œ
- [ ] çŸ¥è¯†åº“åç§°é‡å¤æ ¡éªŒ
- [ ] åˆ—è¡¨æŒ‰çŸ¥è¯†åº“ç­›é€‰æ­£å¸¸

### è¾¹ç•Œæµ‹è¯•
- [ ] ç½‘ç»œå¼‚å¸¸å¤„ç†
- [ ] OSS ä¸Šä¼ å¤±è´¥å¤„ç†
- [ ] åç«¯ API è°ƒç”¨å¤±è´¥å¤„ç†
- [ ] çŸ¥è¯†åº“ä¸ºç©ºæ—¶çš„æ˜¾ç¤º
- [ ] éŸ³é¢‘æ—¶é•¿ä¸º 0 æ—¶çš„å¤„ç†

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’ï¼ˆP1 å’Œ P2ï¼‰

### P1 - çŸ¥è¯†åº“ç®¡ç†å¢å¼º
- [ ] çŸ¥è¯†åº“é‡å‘½ååŠŸèƒ½
- [ ] çŸ¥è¯†åº“åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
- [ ] çŸ¥è¯†åº“æ’åºåŠŸèƒ½
- [ ] ä¼šè®®ç§»åŠ¨åˆ°å…¶ä»–çŸ¥è¯†åº“
- [ ] çŸ¥è¯†åº“ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»æ—¶é•¿ã€æ€»æ•°ç­‰ï¼‰

### P2 - ä¼˜åŒ–ä¸å®Œå–„
- [ ] ä¸Šä¼ å¤±è´¥é‡è¯•æœºåˆ¶
- [ ] æ–­ç‚¹ç»­ä¼ æ”¯æŒ
- [ ] æ‰¹é‡ä¸Šä¼ æ”¯æŒ
- [ ] çŸ¥è¯†åº“æœç´¢åŠŸèƒ½
- [ ] çŸ¥è¯†åº“å›¾æ ‡å’Œé¢œè‰²å®šåˆ¶
- [ ] ä¸Šä¼ å†å²è®°å½•

## ğŸ“š ç›¸å…³æ–‡æ¡£
- [ä¸Šä¼ åŠŸèƒ½å¼€å‘è®¡åˆ’](./UPLOAD_FEATURE_PLAN.md)
- [åç«¯ API æ–‡æ¡£](./backend/README.md)
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT_GUIDE.md)

---

**å¼€å‘å®Œæˆæ—¶é—´**: 2025-11-09  
**å¼€å‘è€…**: Claude & Cosmos  
**ç‰ˆæœ¬**: v1.0.0

