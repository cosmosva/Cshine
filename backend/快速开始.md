# Cshine åŽç«¯å¿«é€Ÿå¼€å§‹æŒ‡å—

## ðŸš€ 5åˆ†é’Ÿå¯åŠ¨åŽç«¯

### æ­¥éª¤ 1ï¼šå®‰è£… Python ä¾èµ–

```bash
# è¿›å…¥åŽç«¯ç›®å½•
cd backend

# åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒï¼ˆæŽ¨èï¼‰
python3 -m venv venv

# æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒ
# macOS/Linux:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### æ­¥éª¤ 2ï¼šé…ç½®çŽ¯å¢ƒå˜é‡

```bash
# åˆ›å»º .env æ–‡ä»¶ï¼ˆä½¿ç”¨ SQLite å¿«é€Ÿå¼€å§‹ï¼‰
cat > .env << EOF
APP_NAME=Cshine API
DEBUG=True
SECRET_KEY=your-secret-key-for-development
DATABASE_URL=sqlite:///./cshine.db
WECHAT_APPID=your_appid
WECHAT_SECRET=your_secret
CORS_ORIGINS=*
EOF
```

### æ­¥éª¤ 3ï¼šè¿è¡Œåº”ç”¨

```bash
# ç›´æŽ¥è¿è¡Œ
python main.py

# åº”ç”¨ä¼šåœ¨ http://localhost:8000 å¯åŠ¨
```

### æ­¥éª¤ 4ï¼šè®¿é—® API æ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

---

## ðŸ“ æµ‹è¯• API

### 1. æµ‹è¯•æ ¹è·¯å¾„

```bash
curl http://localhost:8000/
```

**é¢„æœŸå“åº”**:
```json
{
  "name": "Cshine API",
  "version": "1.0.0",
  "status": "running",
  "docs": "/docs"
}
```

### 2. æµ‹è¯•å¥åº·æ£€æŸ¥

```bash
curl http://localhost:8000/health
```

**é¢„æœŸå“åº”**:
```json
{
  "status": "healthy"
}
```

### 3. æµ‹è¯•ç™»å½•æŽ¥å£ï¼ˆéœ€è¦çœŸå®žå¾®ä¿¡ codeï¼‰

```bash
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "code": "å¾®ä¿¡ç™»å½•code",
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "avatar": "https://example.com/avatar.jpg"
  }'
```

### 4. æµ‹è¯•åˆ›å»ºé—ªè®°ï¼ˆéœ€è¦å…ˆç™»å½•èŽ·å– tokenï¼‰

```bash
curl -X POST http://localhost:8000/api/v1/flash/create \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "è¿™æ˜¯ä¸€æ¡æµ‹è¯•é—ªè®°",
    "summary": "æµ‹è¯•é—ªè®°æ‘˜è¦",
    "category": "å·¥ä½œ"
  }'
```

### 5. æµ‹è¯•èŽ·å–é—ªè®°åˆ—è¡¨

```bash
curl -X GET "http://localhost:8000/api/v1/flash/list?page=1&page_size=20" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## ðŸ—„ï¸ æ•°æ®åº“æŸ¥çœ‹

ä½¿ç”¨ SQLiteï¼ˆå¼€å‘çŽ¯å¢ƒï¼‰ï¼š

```bash
# å®‰è£… sqlite3
# macOS: å·²é¢„è£…
# Ubuntu: sudo apt install sqlite3
# Windows: ä¸‹è½½ sqlite-tools

# æŸ¥çœ‹æ•°æ®åº“
sqlite3 cshine.db

# æŸ¥çœ‹æ‰€æœ‰è¡¨
.tables

# æŸ¥çœ‹ç”¨æˆ·è¡¨
SELECT * FROM users;

# æŸ¥çœ‹é—ªè®°è¡¨
SELECT * FROM flashes;

# é€€å‡º
.exit
```

---

## ðŸ”§ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šç«¯å£è¢«å ç”¨

```bash
# ä¿®æ”¹ç«¯å£
python main.py --port 8001

# æˆ–ä¿®æ”¹ .env ä¸­çš„ PORT é…ç½®
PORT=8001
```

### é—®é¢˜ 2ï¼šæ•°æ®åº“é”™è¯¯

```bash
# åˆ é™¤æ—§æ•°æ®åº“é‡æ–°å¼€å§‹
rm cshine.db
python main.py
```

### é—®é¢˜ 3ï¼šä¾èµ–å®‰è£…å¤±è´¥

```bash
# å‡çº§ pip
pip install --upgrade pip

# ä½¿ç”¨å›½å†…é•œåƒæº
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### é—®é¢˜ 4ï¼šå¾®ä¿¡ç™»å½•å¤±è´¥

- æ£€æŸ¥ `WECHAT_APPID` å’Œ `WECHAT_SECRET` æ˜¯å¦æ­£ç¡®
- ç¡®è®¤å°ç¨‹åºå·²ç»ä¸Šçº¿æˆ–è®¾ç½®äº†æµ‹è¯•å·
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `logs/cshine.log`

---

## ðŸ“¦ ç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²

### ä½¿ç”¨ PostgreSQL

```bash
# 1. å®‰è£… PostgreSQL
# macOS: brew install postgresql
# Ubuntu: sudo apt install postgresql

# 2. åˆ›å»ºæ•°æ®åº“
psql -U postgres
CREATE DATABASE cshine;
CREATE USER cshine_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE cshine TO cshine_user;

# 3. ä¿®æ”¹ .env
DATABASE_URL=postgresql://cshine_user:your_password@localhost:5432/cshine

# 4. è¿è¡Œåº”ç”¨
python main.py
```

### ä½¿ç”¨ Gunicorn + Nginx

```bash
# 1. å®‰è£… gunicorn
pip install gunicorn

# 2. è¿è¡Œï¼ˆ4ä¸ªworkerè¿›ç¨‹ï¼‰
gunicorn main:app \
  -w 4 \
  -k uvicorn.workers.UvicornWorker \
  -b 0.0.0.0:8000 \
  --access-logfile logs/access.log \
  --error-logfile logs/error.log

# 3. é…ç½® Nginx åå‘ä»£ç†ï¼ˆ/etc/nginx/sites-available/cshineï¼‰
server {
    listen 80;
    server_name api.yourdomain.com;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

# 4. å¯ç”¨ç«™ç‚¹å¹¶é‡å¯ Nginx
sudo ln -s /etc/nginx/sites-available/cshine /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

---

## ðŸ” æ—¥å¿—æŸ¥çœ‹

```bash
# å®žæ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/cshine.log

# æœç´¢é”™è¯¯æ—¥å¿—
grep "ERROR" logs/cshine.log

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
tail -n 100 logs/cshine.log
```

---

## ðŸ§ª å¼€å‘å·¥å…·

### ä»£ç æ ¼å¼åŒ–

```bash
# å®‰è£… black
pip install black

# æ ¼å¼åŒ–ä»£ç 
black app/ --line-length 100
```

### ä»£ç æ£€æŸ¥

```bash
# å®‰è£… flake8
pip install flake8

# æ£€æŸ¥ä»£ç 
flake8 app/ --max-line-length=100
```

### æ•°æ®åº“è¿ç§»ï¼ˆä½¿ç”¨ Alembicï¼‰

```bash
# åˆå§‹åŒ– Alembic
alembic init alembic

# åˆ›å»ºè¿ç§»
alembic revision --autogenerate -m "Initial migration"

# æ‰§è¡Œè¿ç§»
alembic upgrade head

# å›žæ»š
alembic downgrade -1
```

---

## ðŸ“š ä¸‹ä¸€æ­¥

- âœ… åŽç«¯åŸºç¡€æ¡†æž¶æ­å»ºå®Œæˆ
- â³ é›†æˆè¯­éŸ³è¯†åˆ«æœåŠ¡ï¼ˆASRï¼‰
- â³ é›†æˆå¤§æ¨¡åž‹æœåŠ¡ï¼ˆLLMï¼‰
- â³ å®žçŽ°å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆCeleryï¼‰
- â³ æ·»åŠ å•å…ƒæµ‹è¯•
- â³ æ€§èƒ½ä¼˜åŒ–å’Œç›‘æŽ§

---

**éœ€è¦å¸®åŠ©ï¼Ÿ**  
æŸ¥çœ‹ `README.md` èŽ·å–å®Œæ•´æ–‡æ¡£  
æˆ–è®¿é—® http://localhost:8000/docs æŸ¥çœ‹ API æ–‡æ¡£

ðŸŒŸ **Happy Coding!**

