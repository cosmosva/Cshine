/**
 * çŠ¶æ€å¾½ç«  WXS æ¨¡å— (v0.9.10)
 * ç”¨äºåœ¨ WXML ä¸­åŠ¨æ€è®¡ç®—ä¼šè®®å¡ç‰‡çš„çŠ¶æ€æ˜¾ç¤º
 */

/**
 * åˆ¤æ–­æ˜¯å¦åº”è¯¥æ˜¾ç¤ºçŠ¶æ€å¾½ç« 
 * @param {Object} meeting - ä¼šè®®å¯¹è±¡
 * @returns {Boolean} æ˜¯å¦æ˜¾ç¤ºå¾½ç« 
 */
function shouldShow(meeting) {
  if (!meeting) return false

  var status = meeting.status

  // pending çŠ¶æ€ä¸æ˜¾ç¤º
  if (status === 'pending') return false

  // completed ä¸”å·²æŸ¥çœ‹ä¸æ˜¾ç¤º
  if (status === 'completed' && meeting.is_viewed) return false

  // å…¶ä»–æƒ…å†µéƒ½æ˜¾ç¤ºï¼ˆprocessing, failed, completed+æœªæŸ¥çœ‹ï¼‰
  return true
}

/**
 * è·å–çŠ¶æ€ç±»å‹ï¼ˆç”¨äºCSSç±»åï¼‰
 * @param {Object} meeting - ä¼šè®®å¯¹è±¡
 * @returns {String} çŠ¶æ€ç±»å‹
 */
function getType(meeting) {
  if (!meeting) return ''

  var status = meeting.status
  var transcript = meeting.transcript

  // processing çŠ¶æ€ï¼šåŒºåˆ†è½¬å½•ä¸­å’Œç”Ÿæˆä¸­
  if (status === 'processing') {
    if (!transcript || transcript.length === 0) {
      return 'transcribing'  // è½¬å½•ä¸­ï¼ˆè“è‰²ï¼‰
    } else {
      return 'generating'  // ç”Ÿæˆä¸­ï¼ˆæ©™è‰²ï¼‰
    }
  }

  // completed çŠ¶æ€ï¼šæœªæŸ¥çœ‹æ˜¾ç¤ºçº¢ç‚¹
  if (status === 'completed' && !meeting.is_viewed) {
    return 'new'  // æ–°å®Œæˆï¼ˆç»¿è‰²+çº¢ç‚¹ï¼‰
  }

  // failed çŠ¶æ€
  if (status === 'failed') {
    return 'failed'  // å¤±è´¥ï¼ˆç°è‰²ï¼‰
  }

  return ''
}

/**
 * è·å–çŠ¶æ€æ–‡æœ¬
 * @param {Object} meeting - ä¼šè®®å¯¹è±¡
 * @returns {String} çŠ¶æ€æ–‡æœ¬
 */
function getText(meeting) {
  if (!meeting) return ''

  var type = getType(meeting)

  if (type === 'transcribing') {
    return 'è½¬å½•ä¸­'
  } else if (type === 'generating') {
    return 'ç”Ÿæˆä¸­'
  } else if (type === 'new') {
    return 'å·²å®Œæˆ ğŸ”´'  // çº¢ç‚¹è¡¨ç¤ºæœªæŸ¥çœ‹
  } else if (type === 'failed') {
    return 'å¤±è´¥'
  }

  return ''
}

module.exports = {
  shouldShow: shouldShow,
  getType: getType,
  getText: getText
}
