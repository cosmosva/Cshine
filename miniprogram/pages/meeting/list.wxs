/**
 * 会议列表页面 WXS 工具函数
 * WXS 是微信小程序的模板脚本，用于在WXML中进行数据处理
 */

/**
 * 格式化完整时间（UTC+8 时区）
 * 输入: 2025-11-07 16:24:36.872975 (UTC)
 * 输出: 2025-11-08 00:24:36 (UTC+8)
 */
var formatFullTime = function(dateStr) {
  if (!dateStr) return ''

  // 移除毫秒部分
  var str = dateStr.toString().split('.')[0]

  // 替换 T 为空格（如果是ISO格式）
  str = str.replace('T', ' ')

  // 解析时间字符串
  var parts = str.split(' ')
  if (parts.length !== 2) return str

  var datePart = parts[0]  // 2025-11-07
  var timePart = parts[1]  // 16:24:36

  var dateComponents = datePart.split('-')
  var timeComponents = timePart.split(':')

  if (dateComponents.length !== 3 || timeComponents.length !== 3) return str

  var year = parseInt(dateComponents[0])
  var month = parseInt(dateComponents[1])
  var day = parseInt(dateComponents[2])
  var hour = parseInt(timeComponents[0])
  var minute = parseInt(timeComponents[1])
  var second = parseInt(timeComponents[2])

  // 加8小时
  hour = hour + 8

  // 处理小时进位
  if (hour >= 24) {
    hour = hour - 24
    day = day + 1

    // 处理日期进位（简化处理，不考虑闰年）
    var daysInMonth = [0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]

    // 闰年判断
    if (year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0)) {
      daysInMonth[2] = 29
    }

    if (day > daysInMonth[month]) {
      day = 1
      month = month + 1

      if (month > 12) {
        month = 1
        year = year + 1
      }
    }
  }

  // 格式化输出（补零）
  var monthStr = month < 10 ? '0' + month : '' + month
  var dayStr = day < 10 ? '0' + day : '' + day
  var hourStr = hour < 10 ? '0' + hour : '' + hour
  var minuteStr = minute < 10 ? '0' + minute : '' + minute
  var secondStr = second < 10 ? '0' + second : '' + second

  return year + '-' + monthStr + '-' + dayStr + ' ' + hourStr + ':' + minuteStr + ':' + secondStr
}

/**
 * 格式化时长
 * 输入: 秒数
 * 输出: 48m 1s 或 1h 20m 30s
 */
var formatDuration = function(seconds) {
  if (!seconds || seconds === 0) return ''
  
  var minutes = Math.floor(seconds / 60)
  var secs = seconds % 60
  
  if (minutes >= 60) {
    var hours = Math.floor(minutes / 60)
    var mins = minutes % 60
    if (mins > 0) {
      return hours + 'h ' + mins + 'm ' + secs + 's'
    }
    return hours + 'h ' + secs + 's'
  }
  
  return minutes + 'm ' + secs + 's'
}

/**
 * 导出函数
 */
module.exports = {
  formatFullTime: formatFullTime,
  formatDuration: formatDuration
}

