# 📝 新功能部署文档模板

> 根据 [后端更新协议](../docs/deployment/BACKEND_UPDATE_PROTOCOL.md) 创建

---

# 🚀 [功能名称] 线上部署方案

> **更新类型**: [新功能 / Bug修复 / 性能优化 / 安全补丁]  
> **更新日期**: YYYY-MM-DD  
> **是否必须**: [必须 🔴 / 建议 🟡 / 可选 🟢]  
> **预计停机时间**: [无 / <5分钟 / <15分钟]

---

## 📋 更新内容

### 1. 功能说明
[简要描述本次更新的功能或改进]

### 2. 涉及文件
- `backend/app/api/xxx.py` - [改动说明]
- `backend/app/models.py` - [改动说明]
- ...

### 3. 数据库变更
- [ ] 无数据库变更
- [ ] 新增表：[表名]
- [ ] 新增字段：[表名.字段名]
- [ ] 修改字段：[表名.字段名]
- [ ] 需要数据迁移

### 4. 依赖变更
- [ ] 无新增依赖
- [ ] 新增依赖：[列出 requirements.txt 中新增的包]

### 5. 环境变量变更
- [ ] 无新增环境变量
- [ ] 新增配置：[列出 .env 中新增的配置项]

---

## ⚠️ 更新前检查

- [ ] 代码已提交到 main 分支
- [ ] 本地测试通过
- [ ] 数据库备份已完成
- [ ] 了解回滚步骤

---

## 🚀 部署步骤

### 方式 1：使用自动脚本（推荐）

```bash
# SSH 登录服务器
ssh root@your_server_ip

# 切换到项目目录
cd /path/to/Cshine

# 运行更新脚本
bash docs/deployment/UPDATE_SERVER.sh

# 查看服务状态
sudo systemctl status cshine-api
```

**预计用时**: 2-5 分钟

---

### 方式 2：手动更新

[如果需要特殊步骤，在此详细说明]

---

## ✅ 更新后验证

### 1. 服务状态检查
```bash
curl https://cshine.xuyucloud.com/health
```

### 2. 功能测试
- [ ] [具体测试步骤1]
- [ ] [具体测试步骤2]

### 3. 日志检查
```bash
tail -50 logs/cshine.log
```

---

## 🔙 回滚方案

```bash
# 1. 停止服务
sudo systemctl stop cshine-api

# 2. 恢复代码
cd /path/to/Cshine
git reset --hard <上一个版本的commit-hash>

# 3. 恢复数据库（如果修改了）
# [具体恢复步骤]

# 4. 重启服务
sudo systemctl start cshine-api
```

---

## 📊 更新记录

| 步骤 | 状态 | 完成时间 | 备注 |
|------|------|---------|------|
| 备份数据库 | ⏳ | - | - |
| 拉取代码 | ⏳ | - | - |
| 更新依赖 | ⏳ | - | - |
| 重启服务 | ⏳ | - | - |
| 功能验证 | ⏳ | - | - |

**更新负责人**: [填写姓名]  
**更新执行时间**: [填写时间]  
**更新结果**: [成功 / 失败 / 已回滚]

---

**文档位置**: 请将此文档保存到 `docs/features/DEPLOY_<功能名>_YYYYMMDD.md`
